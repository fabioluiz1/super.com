#!/bin/sh
# Validate commit messages follow Conventional Commits.
# Installed by `mise run setup`. Source: scripts/hooks/commit-msg

MSG=$(head -1 "$1")

# Allow merge commits
if echo "$MSG" | grep -qE '^Merge '; then
  exit 0
fi

# Conventional Commits: type(scope): description
if ! echo "$MSG" | grep -qE '^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .+$'; then
  echo ""
  echo "ERROR: commit message does not follow Conventional Commits."
  echo ""
  echo "  Format:  type(scope): description"
  echo "  Types:   feat fix docs style refactor perf test build ci chore revert"
  echo ""
  echo "  Examples:"
  echo "    feat: add filtering by city"
  echo "    fix(auth): handle expired tokens"
  echo "    docs: update README quickstart"
  echo ""
  echo "  Your message: $MSG"
  echo ""
  exit 1
fi
